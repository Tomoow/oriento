<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oriento - Cadeaubon</title>
    <link rel="icon" type="image/svg+xml" href="img/favicon.svg">
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script defer src="https://cloud.umami.is/script.js" data-website-id="0ab64e85-45ea-4c78-865c-c0731fd3dd7d"></script>
</head>
<body>
    <div class="header-wrapper">
        <!-- Announcement Banner -->
        <div class="announcement-banner" id="announcement-banner" style="display: none;">
            <div class="announcement-content">
                <i data-lucide="alert-triangle" class="announcement-icon"></i>
                <div class="announcement-text" id="announcement-text"></div>
                <button class="icon-button announcement-close" id="announcement-close" aria-label="Close announcement" data-umami-event="Close Announcement">
                    <i data-lucide="x"></i>
                </button>
            </div>
        </div>

        <header class="site-header">
            <div class="header-container">
                <nav class="main-nav">
                    <a href="/" class="logo">
                        <img src="img/logo.svg" alt="Oriento Logo">
                    </a>
                    <div class="header-social">
                        <a href="https://www.facebook.com/profile.php?id=100063604631891" target="_blank" aria-label="Facebook" data-umami-event="Social - Facebook">
                            <i data-lucide="facebook"></i>
                        </a>
                        <a href="instagram://user?username=oriento_home.fashion" data-fallback="https://www.instagram.com/oriento_home.fashion/" class="instagram-link" aria-label="Instagram" data-umami-event="Social - Instagram">
                            <i data-lucide="instagram"></i>
                        </a>
                        <button class="hamburger" aria-label="Menu" data-umami-event="Toggle Menu">
                            <span></span>
                            <span></span>
                            <span></span>
                        </button>
                    </div>
                    <ul class="nav-menu">
                        <li><a href="/" data-umami-event="Nav - Home"><i data-lucide="home"></i> Home</a></li>
                        <li><a href="/collectie.html" data-umami-event="Nav - Collectie"><i data-lucide="shopping-bag"></i> Collectie</a></li>
                        <li><a href="/about.html" data-umami-event="Nav - Over ons"><i data-lucide="users"></i> Over ons</a></li>
                        <li><a href="/cadeaubon.html" class="active" data-umami-event="Nav - Cadeaubon"><i data-lucide="gift"></i> Cadeaubon</a></li>
                    </ul>
                </nav>
            </div>
        </header>
    </div>

    <section class="giftcard-section">
        <div class="giftcard-container">
            <!-- Tab Navigation -->
            <div class="giftcard-tabs">
                <button type="button" class="giftcard-tab giftcard-tab-active" data-tab="online" data-umami-event="Giftcard Tab - Online">
                    Online
                </button>
                <button type="button" class="giftcard-tab" data-tab="store" data-umami-event="Giftcard Tab - Fysiek">
                    Fysiek
                </button>
            </div>
            
            <!-- Online Cadeaubon Content (visible by default) -->
            <div class="giftcard-content-wrapper" id="giftcard-online-content">
                <div class="giftcard-online">
                    <!-- In-app browser replacement (shown instead of iframe) -->
                    <div class="giftcard-in-app-replacement" id="giftcard-in-app-replacement" style="display: none;">
                        <div class="giftcard-in-app-content">
                            <i data-lucide="gift" class="giftcard-in-app-icon"></i>
                            <p>Klik op de knop hieronder om een cadeaubon te kopen:</p>
                            <a href="https://cdn.giftup.app/dist/checkout.html?site=6c95273a-a914-498b-dd57-08de1ad66191&environment=Production&instance=z8k6en6czt" target="_blank" class="btn btn-primary" data-umami-event="Giftcard - In-App Browser Direct Link">
                                Koop een cadeaubon
                            </a>
                        </div>
                    </div>
                    <div class="giftcard-widget" id="giftcard-widget">
                        <div class="gift-up-target" data-site-id="6c95273a-a914-498b-dd57-08de1ad66191" data-platform="Other" data-locale="nl_NL"></div>
                    </div>
                </div>
            </div>

            <!-- Fysieke Cadeaubon Content (hidden by default) -->
            <div class="giftcard-content-wrapper giftcard-hidden" id="giftcard-store-content">
                <div class="giftcard-store-card">
                    <div class="giftcard-store-image">
                        <img src="img/cadeaubon.webp" alt="Ingepakte cadeaubon">
                    </div>
                    <div class="giftcard-store-content">
                        <h3>Bezoek onze winkel voor een prachtig ingepakte cadeaubon</h3>
                        <p>Liever persoonlijk advies en een cadeaubon die met zorg is ingepakt? Kom dan langs in onze winkel in Zwevegem. We helpen je graag om de perfecte cadeaubon te kiezen en maken er een mooi geschenk van, klaar om te geven.</p>
                        <a href="https://www.google.com/maps/search/?api=1&query=Otegemstraat+31,+8550+Zwevegem,+Belgium" target="_blank" class="btn btn-primary" data-umami-event="Giftcard - Visit Store">Kom naar onze winkel</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-info">
                <h3>Oriento</h3>
                <p>Otegemstraat 31</p>
                <p>8550 Zwevegem</p>
                <p>Tel: <a href="tel:056754577">056/75.45.77</a></p>
                <p>Email: <a href="mailto:oriento@skynet.be">oriento@skynet.be</a></p>
                <p>BTW: BE 0678.212.914</p>
                
                <div class="footer-social">
                    <a href="https://www.facebook.com/profile.php?id=100063604631891" target="_blank" aria-label="Facebook">
                        <i data-lucide="facebook"></i>
                    </a>
                    <a href="instagram://user?username=oriento_home.fashion" data-fallback="https://www.instagram.com/oriento_home.fashion/" class="instagram-link" aria-label="Instagram">
                        <i data-lucide="instagram"></i>
                    </a>
                </div>
            </div>
            
            <div class="footer-hours">
                <h4>Openingsuren</h4>
                <div class="hours-grid">
                    <div class="day-hours">
                        <span class="day">Maandag</span>
                        <span class="hours">Gesloten</span>
                    </div>
                    <div class="day-hours">
                        <span class="day">Dinsdag</span>
                        <span class="hours">10:00 - 12:00 en 14:00 - 18:00</span>
                    </div>
                    <div class="day-hours">
                        <span class="day">Woensdag</span>
                        <span class="hours">10:00 - 12:00 en 14:00 - 18:00</span>
                    </div>
                    <div class="day-hours">
                        <span class="day">Donderdag</span>
                        <span class="hours">14:00 - 18:00</span>
                    </div>
                    <div class="day-hours">
                        <span class="day">Vrijdag</span>
                        <span class="hours">10:00 - 12:00 en 14:00 - 18:00</span>
                    </div>
                    <div class="day-hours">
                        <span class="day">Zaterdag</span>
                        <span class="hours">10:00 - 12:00 en 14:00 - 18:00</span>
                    </div>
                    <div class="day-hours">
                        <span class="day">Zondag</span>
                        <span class="hours">Gesloten</span>
                    </div>
                </div>
            </div>
            
            <div class="footer-nav">
                <h4>Pages</h4>
                <a href="/">Home</a>
                <a href="/about.html">Over ons</a>
                <a href="/collectie.html">Collectie</a>
                <a href="/cadeaubon.html">Cadeaubon</a>
            </div>
        </div>
        
        <div class="footer-bottom">
            <div class="footer-bottom-content">
                <div class="footer-bottom-left">
                    <button type="button" id="dark-mode-toggle" class="dark-mode-toggle" aria-label="Toggle dark mode" role="switch" aria-checked="false" data-umami-event="Toggle Dark Mode">
                        <span class="toggle-slider">
                            <span class="toggle-thumb"></span>
                        </span>
                        <span class="toggle-label">Dark mode</span>
                    </button>
                    <span class="footer-separator">|</span>
                    <a href="#" class="footer-bottom-link" data-modal="privacy" data-umami-event="Open Privacy Modal">Privacy</a>
                    <span class="footer-separator">|</span>
                    <a href="#" class="footer-bottom-link" data-modal="algemene-voorwaarden" data-umami-event="Open Algemene Voorwaarden Modal">Algemene Voorwaarden</a>
                </div>
                <div class="footer-copyright">
                    <p>Â© Oriento 2025</p>
                    <p class="website-creator">Website made by Tom Lievens</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Popup Modal (shown on page load if enabled) -->
    <div id="popup-modal" class="modal">
        <div class="modal-content popup-modal-content">
            <button class="icon-button modal-close popup-close" aria-label="Close popup" data-umami-event="Close Popup Modal">
                <i data-lucide="x"></i>
            </button>
            <div class="popup-modal-body">
                <div class="popup-image-wrapper" id="popup-image-wrapper">
                    <img id="popup-image" src="" alt="Popup">
                </div>
                <h2 id="popup-title"></h2>
                <div id="popup-text" class="popup-text"></div>
            </div>
        </div>
    </div>

    <!-- Modal for Privacy -->
    <div id="privacy-modal" class="modal">
        <div class="modal-content">
            <button class="icon-button modal-close" aria-label="Close modal" data-umami-event="Close Privacy Modal">
                <i data-lucide="x"></i>
            </button>
            <div id="privacy-content"></div>
        </div>
    </div>

    <!-- Gift Up script -->
    <script type="text/javascript">
    (function (g, i, f, t, u, p, s) {
        g[u] = g[u] || function() { (g[u].q = g[u].q || []).push(arguments) };
        p = i.createElement(f);
        p.async = 1;
        p.src = t;
        s = i.getElementsByTagName(f)[0];
        s.parentNode.insertBefore(p, s);
    })(window, document, "script", "https://cdn.giftup.app/dist/gift-up.js", "giftup");
    
    // Set locale to Dutch for Mollie payment page
    // Wait for Gift-up to fully load before setting locale
    document.addEventListener('DOMContentLoaded', function() {
        // Try to set locale after a short delay to ensure Gift-up is loaded
        setTimeout(function() {
            if (window.giftup) {
                try {
                    window.giftup('setLocale', 'nl_NL');
                } catch(e) {
                    console.log('Gift-up locale setting:', e);
                }
            }
        }, 1000);
    });
    
    // Also try setting it immediately if giftup is already available
    if (window.giftup) {
        try {
            window.giftup('setLocale', 'nl_NL');
        } catch(e) {
            // Will retry on DOMContentLoaded
        }
    }
    
    // BEST PRACTICE: Break out of iframe for payment redirects
    // This implements the industry-standard solution for in-app browser payment issues
    (function() {
        // 1. Detect in-app browsers
        function isInAppBrowser() {
            const ua = navigator.userAgent || navigator.vendor || window.opera;
            return ua.includes('Instagram') ||
                   ua.includes('FBAN') ||
                   ua.includes('FBAV') ||
                   ua.includes('Messenger') ||
                   ua.includes('FBSV');
        }
        
        const inAppBrowser = isInAppBrowser();
        
        // 2. Replace iframe with direct link if in-app browser detected
        if (inAppBrowser) {
            const widget = document.getElementById('giftcard-widget');
            const replacement = document.getElementById('giftcard-in-app-replacement');
            
            if (widget && replacement) {
                // Hide the iframe widget
                widget.style.display = 'none';
                // Show the replacement content
                replacement.style.display = 'block';
                
                // Re-initialize Lucide icons
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
                
                // Don't monitor iframe since it's hidden
                return;
            }
        }
        
        // 3. Monitor iframe for Mollie payment URL and do top-level redirect
        const widgetContainer = document.querySelector('.giftcard-widget');
        if (!widgetContainer) return;
        
        let lastIframeSrc = null;
        let iframeCheckInterval = null;
        
        function monitorIframe() {
            const iframe = widgetContainer.querySelector('iframe');
            
            if (iframe && iframe.src) {
                const currentSrc = iframe.src;
                
                // Detect if iframe URL changed to Mollie payment
                if (lastIframeSrc && currentSrc !== lastIframeSrc) {
                    // Check if it's a Mollie payment URL
                    if (currentSrc.includes('mollie') || currentSrc.includes('mollie.com') ||
                        (currentSrc.includes('payment') && (currentSrc.includes('checkout') || currentSrc.includes('pay')))) {
                        
                        // CRITICAL: Break out of iframe with top-level redirect
                        // This is the industry-standard solution that works in most cases
                        window.location.href = currentSrc;
                        return; // Stop monitoring
                    }
                }
                
                if (!lastIframeSrc) {
                    lastIframeSrc = currentSrc;
                }
            }
        }
        
        // Start monitoring after Gift-up loads
        setTimeout(function() {
            iframeCheckInterval = setInterval(monitorIframe, 500); // Check every 500ms
        }, 2000);
        
        // Also monitor for iframe creation
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                mutation.addedNodes.forEach(function(node) {
                    if (node.tagName === 'IFRAME' || (node.querySelector && node.querySelector('iframe'))) {
                        setTimeout(monitorIframe, 500);
                    }
                });
            });
        });
        
        observer.observe(widgetContainer, {
            childList: true,
            subtree: true
        });
        
        // 4. Listen for postMessage from Gift-up iframe (if they support it)
        window.addEventListener('message', function(event) {
            // Check if message is from Gift-up domain
            if (event.origin.includes('giftup.app') || event.origin.includes('gift-up')) {
                // If Gift-up sends payment URL via postMessage, use it
                if (event.data && event.data.paymentUrl) {
                    window.location.href = event.data.paymentUrl;
                } else if (event.data && (event.data.action === 'start-payment' || event.data.action === 'redirect')) {
                    // If they send a redirect action, try to get URL from iframe
                    const iframe = widgetContainer.querySelector('iframe');
                    if (iframe && iframe.src) {
                        window.location.href = iframe.src;
                    }
                }
            }
        });
        
        // Cleanup
        window.addEventListener('beforeunload', function() {
            if (iframeCheckInterval) {
                clearInterval(iframeCheckInterval);
            }
        });
    })();
    </script>

    <script src="script.js"></script>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
        if (window.netlifyIdentity) {
            window.netlifyIdentity.on("init", user => {
                if (!user) {
                    window.netlifyIdentity.on("login", () => {
                        document.location.href = "/admin/";
                    });
                }
            });
        }
        
        // Initialize Lucide icons
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
        
        // Giftcard tabs functionality
        (function() {
            const tabs = document.querySelectorAll('.giftcard-tab');
            const onlineContent = document.getElementById('giftcard-online-content');
            const storeContent = document.getElementById('giftcard-store-content');
            
            if (tabs.length === 0 || !onlineContent || !storeContent) return;
            
            function switchTab(activeTab) {
                // Update tab buttons
                tabs.forEach(tab => {
                    if (tab.getAttribute('data-tab') === activeTab) {
                        tab.classList.add('giftcard-tab-active');
                        tab.setAttribute('aria-selected', 'true');
                    } else {
                        tab.classList.remove('giftcard-tab-active');
                        tab.setAttribute('aria-selected', 'false');
                    }
                });
                
                // Update content visibility
                if (activeTab === 'online') {
                    onlineContent.classList.remove('giftcard-hidden');
                    storeContent.classList.add('giftcard-hidden');
                } else {
                    onlineContent.classList.add('giftcard-hidden');
                    storeContent.classList.remove('giftcard-hidden');
                }
            }
            
            // Add click handlers to tabs
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
            
            // Initialize: online is active by default
            switchTab('online');
        })();
        
        // Make giftcard store card clickable (desktop only)
        (function() {
            const storeCard = document.querySelector('.giftcard-store-card');
            const storeButton = document.querySelector('.giftcard-store-content .btn-primary');
            
            if (!storeCard || !storeButton) return;
            
            function updateCardClickability() {
                const isDesktop = window.innerWidth > 768;
                
                if (isDesktop) {
                    // Make card clickable on desktop
                    storeCard.style.cursor = 'pointer';
                    
                    // Remove existing listener if any
                    storeCard.removeEventListener('click', handleCardClick);
                    storeCard.addEventListener('click', handleCardClick);
                } else {
                    // Remove clickability on mobile
                    storeCard.style.cursor = 'default';
                    storeCard.removeEventListener('click', handleCardClick);
                }
            }
            
            function handleCardClick(e) {
                // Don't navigate if clicking directly on the button (let button handle it)
                if (e.target.closest('.btn-primary')) {
                    return;
                }
                
                // Navigate to the button's href
                const buttonHref = storeButton.getAttribute('href');
                if (buttonHref) {
                    window.open(buttonHref, storeButton.getAttribute('target') || '_self');
                }
            }
            
            // Initialize
            updateCardClickability();
            
            // Update on resize
            let resizeTimeout;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(updateCardClickability, 100);
            });
        })();
    </script>
</body>
</html>

